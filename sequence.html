
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <title>GTFS Manager : Stops</title>

    
   <!-- Fontfaces CSS-->
   <link href="css/font-face.css" rel="stylesheet" media="all">
   <link href="vendor/font-awesome-5/css/all.min.css" rel="stylesheet" media="all">

   <!-- Bootstrap CSS-->
   <link href="vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

	<!-- Leaflet Maps -->
	<link href="lib/leaflet.css" orig="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" rel="stylesheet"/>
	<link href="lib/easy-button.css" alt="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css" rel="stylesheet"/>
	<link href="lib/L.Control.ZoomBox.css" rel="stylesheet"/>
    <link href="vendor/leaflet-control-geocoder-1.8.2/Control.Geocoder.css" rel="stylesheet" />
	
    <!-- Vendor CSS-->
   <link href="vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
   <link href="vendor/wow/animate.css" rel="stylesheet" media="all">
   <link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
   <link href="vendor/slick/slick.css" rel="stylesheet" media="all">
   <link href="vendor/select2/css/select2.min.css" rel="stylesheet" media="all">
   <link href="vendor/select2/css/select2-bootstrap4.min.css" rel="stylesheet" media="all">
   <link href="vendor/toast-0.7.1/toast.min.css" rel="stylesheet" media="all">

   <link href="vendor/tabulator-4.2.7/css/bootstrap/tabulator_bootstrap4.min.css" rel="stylesheet" media="all">
   <script src="vendor/tabulator-4.2.7/js/tabulator.min.js"></script>

    <!-- Main CSS-->
    <link href="css/theme.css" rel="stylesheet" media="all">
    <!-- Put the CSSs first and JSs next -->
	<style>
		.map-container {
		height: 100%;
		/* Fallback for vmin */
		padding: 0px 1rem 1rem 1rem;
		padding: 0px 1vmin 1vmin 1vmin;
		}

		.map-frame {
		height: 100%;
		width: 100%;
		/*   We use outline over border as has issues in some cases */
		outline: 1px solid black;
		}

		#map0, #map1 { 
		height: 100%;
		z-index: 0;
		}

		/* #map0, #map1 {
			height: 400px;
			z-index: 0;
		} */
		
		#sequence-0-table, #sequence-1-table {
			height: 350px;
		}
		
		 #routes-table {
			height: 400px;
		}
		
		input[type=checkbox]#reverseCheck {
		 width: 20px; height: 20px;
		 -webkit-border-radius: 22px; -moz-border-radius: 22px; border-radius: 22px;
		  border: 1px solid #bbb;
		  vertical-align: middle; 
		}
		
		
		/* Leaflet Map Overlay */
		.overlaycontainer {
			position: relative;
			width:100%;
			height: 400px;
		}
		
		/* #map0 {
			position:absolute;
			width: 100%;
		} */
		.shapeOverlay {
			position:absolute;
			background-color: rgba(255,255,255,.5);
			height:auto;
			width: auto;
			top:10px;
			right:10px;
			border-radius: 5px;
			padding: 5px;
			box-shadow:0px 0px 20px black; 
		}
		
		#shapes0List .chosen-container .chosen-drop {
			background-color: rgba(255,255,255,.7)!important;
		}
		/* for map, custom markers */
		
		.sequence-0-divicon, .sequence-1-divicon {
			border-radius: 50%;
			color: white;
			padding-top: 2px;
			position: absolute;
			text-align: center;
			overflow: hidden;
			box-shadow:0px 0px 10px black; /*looks 3D! no need of a border*/
		}
		
		.sequence-0-divicon {
			background-color: rgba(0, 0, 255, 0.7);
		}
		.sequence-1-divicon {
			background-color: rgba(128, 0,128,0.7);
		}
		
		/* Chosen JS autocomplete
		.chosen-search-input {
			font-size: 14px;
		} */
		/*
		.notinSequence .leaflet-popup-content-wrapper {
			background: #666;
			color: #fff;
			
		}
		.notinSequence .leaflet-popup-tip {
			background: #666;
		}
		.notinSequence {
			background: #666;
			color: #fff;
		}
		*/
		
		</style>
</head>

<body class="animsition">
        <div class="page-wrapper">
            <!-- HEADER MOBILE-->
            <header class="header-mobile d-block d-lg-none">
                <div class="header-mobile__bar">
                    <div class="container-fluid">
                        <div class="header-mobile-inner">
                            <a class="logo" href="index.html">
                                <img src="extra_files/GTFS.png"  height="44" width="auto" alt="GTFs Manager" />
                            </a>
                            <button class="hamburger hamburger--slider" type="button">
                                <span class="hamburger-box">
                                    <span class="hamburger-inner"></span>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
                <nav class="navbar-mobile">
                    <div class="container-fluid">
                        <ul class="navbar-mobile__list list-unstyled" id="navbar-mobile">
                            <li class="has-sub">
                                <a class="js-arrow" href="index.html">
                                    <i class="fas fa-tachometer-alt"></i>Home</a>                                
                            </li>
                            <li>
                                <a href="chart.html">
                                    <i class="fas fa-chart-bar"></i>Charts</a>
                            </li>
                            <li>
                                <a href="table.html">
                                    <i class="fas fa-table"></i>Tables</a>
                            </li>
                            <li>
                                <a href="form.html">
                                    <i class="far fa-check-square"></i>Forms</a>
                            </li>
                            <li>
                                <a href="#">
                                    <i class="fas fa-calendar-alt"></i>Calendar</a>
                            </li>
                            <li>
                                <a href="map.html">
                                    <i class="fas fa-map-marker-alt"></i>Maps</a>
                            </li>
                            <li class="has-sub">
                                <a class="js-arrow" href="#">
                                    <i class="fas fa-copy"></i>Pages</a>
                                <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                    <li>
                                        <a href="login.html">Login</a>
                                    </li>
                                    <li>
                                        <a href="register.html">Register</a>
                                    </li>
                                    <li>
                                        <a href="forget-pass.html">Forget Password</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="has-sub">
                                <a class="js-arrow" href="#">
                                    <i class="fas fa-desktop"></i>GTFS</a>
                                <ul class="navbar-mobile-sub__list list-unstyled js-sub-list">
                                    <li>
                                        <a href="button.html">Button</a>
                                    </li>
                                    
                                </ul>
                            </li>
                        </ul>
                    </div>
                </nav>
            </header>
            <!-- END HEADER MOBILE-->
    
            <!-- MENU SIDEBAR-->
            <aside class="menu-sidebar d-none d-lg-block">
                <div class="logo">
                    <a href="#">
                        <img src="extra_files/GTFS.png" height="44" width="auto" alt="GTFS Manager" />
                    </a>
                </div>
                <div class="menu-sidebar__content js-scrollbar1">
                        <nav class="navbar-sidebar">
                                <ul class="list-unstyled navbar__list">
                                        <li>
                                            <a class="js-arrow" href="index.html">
                                                    <i class="fas fa-home"></i>Home</a>                                        
                                        </li>
                                        <li class="has-sub">
                                            <a class="js-arrow" href="#">
                                                    <i class="fas fa-bus"></i></i>GTFS</a>
                                            <ul class="list-unstyled navbar__sub-list js-sub-list">
                                                <li>
                                                    <a href="agency.html"><i class="fas fa-building"></i>Agency</a>
                                                </li>
                                                <li class="active">
                                                    <a href="stops.html"><i class="fas fa-map-marker-alt"></i>Stops</a>
                                                </li>
                                                <li>
                                                    <a href="routes.html"><i class="fas fa-road"></i>Routes</a>
                                                </li>
                                                <li>
                                                    <a href="calendar.html"><i class="fas fa-calendar"></i>Calendar</a>
                                                </li>
                                                <li>
                                                    <a href="tripstimings.html"><i class="fas fa-stopwatch"></i>Trips, Stop_times</a>
                                                </li>
                                                <li>
                                                    <a href="frequencies.html"><i class="fas fa-wave-square"></i>Frequencies</a>
                                                </li>
                                                <li>
                                                    <a href="fares.html"><i class="fas fa-dollar-sign"></i>Fares</a>
                                                </li>
                                                <li>
                                                    <a href="translations.html"><i class="fas fa-language"></i>Translations</a>
                                                </li>                                            
                                            </ul>
                                        </li>
                                        <li class="has-sub">
                                            <a class="js-arrow" href="#">
                                                <i class="fas fa-tools"></i>Tools</a>
                                            <ul class="list-unstyled navbar__sub-list js-sub-list">
                                                <li class="active">
                                                    <a href="sequence.html"><i class="fas fa-align-justify"></i>Default Route Sequence</a>
                                                </li>
                                                <li>
                                                    <a href="renameID.html"><i class="fas fa-pen"></i>Rename ID</a>
                                                </li>
                                                <li>
                                                    <a href="deleteID.html"><i class="fas fa-trash"></i>Delete ID</a>
                                                </li>
                                                                                            
                                            </ul>
                                        </li>
                                        <li class="has-sub">
                                            <a class="js-arrow" href="#">
                                                    <i class="fas fa-database"></i>Data</a>
                                            <ul class="list-unstyled navbar__sub-list js-sub-list">
                                                <li>
                                                    <a href="kmrl.html"><i class="fas fa-file-import"></i>Import KMRL format</a>
                                                </li>
                                                <li>
                                                    <a href="hmrl.html"><i class="fas fa-file-import"></i>Import HRML format</a>
                                                </li>                                   
                                            </ul>
                                        </li>
                                    </ul>
                        </nav>
                </div>
            </aside>
            <!-- END MENU SIDEBAR-->
    
            <!-- PAGE CONTAINER-->
            <div class="page-container">
                <!-- HEADER DESKTOP-->
                <header class="header-desktop">
                    <div class="section__content section__content--p30">
                        <div class="container-fluid">
                            <div class="header-wrap">
                                    An open source tool for managing and creating public transit schedules data in static GTFS format.
                                <form class="form-header" action="" method="POST">
                                    <input class="au-input au-input" type="text" name="search" placeholder="pw for edits" id="password" />
                                    <button class="au-btn--submit" type="submit">
                                        <i class="zmdi zmdi-search"></i>
                                    </button>
                                </form>                                
                        </div>
                    </div>
                </header>
                <!-- HEADER DESKTOP-->
    
                <!-- MAIN CONTENT-->
                <div class="main-content">
                    <div class="section__content section__content--p30">
                        <div class="container-fluid">
							<div class="row">
								<div class="col-md-12">
									<div class="accordion" id="accordionExample">
										<div class="card">
										  <div class="card-header" id="headingOne">
											<h2 class="mb-0">
											  <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
												<i class="fas fa-angle-right"></i> Instructions
											  </button>
											</h2>
										  </div>									  
										  <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
											<div class="card-body">
												<p>
													1. Pick a route from the dropdown.<br>
													2. This will make the program populate the tables and maps. Scroll down to see your route's onward and return journey laid out in map and tabular form<br>
													3. You can alter a route's sequence by dragging stops in the sequence table up or down by clicking on and holding the handlebars on their left edge. Add more stops to your route with the small selector below each table. <br>
													4. Every time you move stops, the map on the right will update to reflect the new order. Zoom in to the map by using the zoom controls on the map's top left corner.<br>
													5. Clicking on a stop on either map or table will highlight it in both map and table.<br>
													6. There is a Shape menu floating on the map on top right corner. Click on the dropdown to change the shape. If loaded, you will see the shape on the map as a line connecting the stops. See the arrow to know the direction (may need to zoom in a bit to see it clearly).<br>
													7. If you have drawn out the route in a shapefile (having a chain of co-ordinates, called PolyLine), then you can upload it with the "Upload Shapefile" button that appears just below the first (onward) map and above the second (return) map.<br>
													8. If you are designing a new route and have finished laying out the onwards journey by adding stops in sequence, then clicking one of the buttons under "Mirror onward journey" will make an opposite sequence of it in the Return journey table.<br>
													7. Save the Sequence with the big green button at the bottom when done.<br>
													</p>
													
													<p>
													Note: Changing the default sequence for a route will not change all the trips already existing under this route. The new sequence will reflect only when you create new trips. GTFS standard doesn't store a default stops sequence for a route, so this program is storing it in a separate database file called sequences.json.</p>
											</div>
										  </div>
										</div>
									</div>
								</div>
							</div>
							<div class="row card">
								<div class="col-md-12">
									<div class="card">
										<div class="card-body">
											Select a route: 
											<select id="routeSelect" class="form-control"></select>
											<small id="sequenceLoadStatus"></small>
										</div>
									</div>
								</div>
							</div>
							<!-- Onward Journey (Direction 0) -->
							<div class="row">
								<div class="col-md-6">
										<div class="card">					
											<div class="card-body">
													<h5 class="card-title">Onward Journey (Direction 0)</h5>
												<div id="sequence-0-table"></div>
											</div>									
											<div class="card-footer">
												<div class="row">
													<div class="col-md-10">
														<select id="stopChooser0" class="form-control"></select>
													</div>
													<div class="col-md-2">
														<button class="btn btn-primary" id="add-0" type="button">Add</button>
													</div>
												</div>
											</div>
									  </div>
								</div>
								<div class="col-md-6">
									<div id="map0"></div>
										<div class="shapeOverlay" data-toggle="popover" data-trigger="hover" data-placement="left" data-html="true" title="Shape" data-content="<p>Pick which will be the default shape for this route and direction.<br>&#10004; - Currently saved default shape<br>^ - Just uploaded.<br># - Also being used by some or all trips on this route and direction. (see Schedules section)</p>">
										<h6>Shape</h6>
										<select id="shapes0List" class="chooser"></select>
									</div>
								</div>
							</div>
							<div class="container">
							<div class="row">
								<div class="col-md-6">
									<p>Mirror onward journey: <button id="flipSequenceReplace" class="btn btn-outline-danger" title="Will turn the return journey (the table below) into a mirror image of the onward journey (the table above)" data-toggle="tooltip" data-placement="top">replace</button>
										/ <button id="flipSequenceInsert" class="btn btn-outline-info" title="will NOT erase present return journey sequence; a mirror image of onward journey will be inserted at the top of the table below." data-toggle="tooltip" data-placement="top">insert</button>
									</p>
								</div>
								<div class="col-md-6">
									<p>Want to set a new shape for this route? <button class="btn btn-primary" id="openShapeModal" data-toggle="modal" data-target="#UploadShapeModal" disabled>Upload Shapefile</button></p> 
<p><small><div id="openShapeModalStatus"></div></small></p>

								</div>
							</div>
							</div>
							<!-- Return Journey (Direction 1) -->
							<div class="row">
								<div class="col-md-6">
									<div class="card">					
										<div class="card-body">
												<h5 class="card-title">Return Journey (Direction 1)</h5>
											<div id="sequence-1-table"></div>
										</div>									
										<div class="card-footer">
											<div class="row">
												<div class="col-md-10">
													<select id="stopChooser1" class="form-control"></select>
												</div>
												<div class="col-md-2">
													<button class="btn btn-primary" id="add-1" type="button">Add</button>
												</div>
											</div>
										</div>
									</div>															
								</div>
								<div class="col-md-6">
									<div id="map1"></div>
<div class="shapeOverlay" data-toggle="popover" data-trigger="hover" data-placement="left" data-html="true" title="Shape" data-content="<p>Pick which will be the default shape for this route and direction.<br>&#10004; - Currently saved default shape<br>^ - Just uploaded.<br># - Also being used by some or all trips on this route and direction. (see Schedules section)</p>">
<h6>Shape</h6>
<select id="shapes1List" class="chooser"></select>
</div>
								</div>
							</div>
							<div class="container">
								<div class="row">								
									<div class="col-md-4">
										<p><button id="saveSequence" class="btn btn-success btn-lg">Save Sequence to DB</button> &nbsp; <span id="sequenceSaveStatus"></span></p>
									</div>
									<div class="col-md-8">
										
	<ul><li>
	Be sure to finalize the sequence of your route and save changes to DB before proceeding to the Schedules section.
	</li><li>
	After saving, please reload the page to see all changes take effect.
	</li><li>Note: Shapes chosen here will be saved for future trips to be created; they will not be assigned to all pre-existing trips under this route. To do that, please visit the Maintenance section.
	</li></ul>
									</div>
								</div>
							</div>
                        </div>
                    </div>
                </div>
                <!-- END MAIN CONTENT-->
                <!-- END PAGE CONTAINER-->
            </div>
    
        </div>
    
         <!-- Jquery JS-->
         <script src="vendor/jquery-3.2.1.min.js"></script>
         <!-- Bootstrap JS-->
         <script src="vendor/bootstrap-4.1/popper.min.js"></script>
         <script src="vendor/bootstrap-4.1/bootstrap.min.js"></script>
        
		<!-- Leaflet Maps -->
		
		<script src="lib/leaflet.js"></script>
		<script src="lib/leaflet.textpath.js"></script>
		<script src="lib/leaflet-ant-path.js"></script>
		<script src="lib/easy-button.js" alt="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
		<script src="lib/papaparse.min.js" type="text/javascript"></script>
        <script src="lib/L.Control.ZoomBox.min.js" type="text/javascript"></script>
		<script src="vendor/leaflet-control-geocoder-1.8.2/Control.Geocoder.js"></script>
		<script src="vendor/togeojson/togeojson.js"></script>

        <!-- Vendor JS       -->
        <script src="vendor/animsition/animsition.min.js"></script>
        <script src="vendor/circle-progress/circle-progress.min.js"></script>
        <script src="vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
        <script src="vendor/chartjs/Chart.bundle.min.js"></script>
        <script src="vendor/select2/js/select2.min.js"></script>
        <script src="js/Select2EditorTimezone.js"></script>		
		<script src="vendor/toast-0.7.1/toast.min.js"></script>
		
        <!-- Main JS-->
        <script src="js/main.js"></script>
    
    

<script src="config/settings.js" type="text/javascript"></script>
<script src="js/commonfuncs.js" type="text/javascript"></script>
<script src="js/sequence.js"></script>

<!-- The Modal -->
<div class="modal" tabindex="-1" role="dialog" id="UploadShapeModal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Upload a shape</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
			<div class="row">
				<div class="col-md-7">	
					<b>Onward Journey:</b>
					<p>Upload a shapefile (.geojson format): <small><a href="xml_related/R001.geojson" target="_blank">see sample</a></small></p>
					<p><input type="file" id="uploadShape0" name="uploadShape0" class="btn btn-sm btn-outline-secondary" accept=".geojson, .kml"></p>
					<p><label>Pick a Shape id prefix: <input size=4 id="uploadShapeId" placeholder="shape_id" class="form-control"></label></p>
				</div>
				<div class="col-md-5">
					<p class="alert alert-info">
					Don't have a shapefile in .geojson format? You can convert or create one here: <a href="http://geojson.io" target="_blank">geojson.io</a><br><br>
					<small>Shape id prefix must be unique, unless you want to overwrite an existing shape. Directions will be added.
					<br>Example: R001: <i>R001_0, R001_1</i>
					</small></p>
				</div>
			</div>	
			<div class="row">
				<div class="col-md-6">
					<p><b>Return Direction:</b><br>
						<div class="form-check">
								<input class="form-check-input" type="checkbox" value="reverseCheck" id="reverseCheck">
								<label class="form-check-label" for="reverseCheck">
										Check ON if you are uploading another shapefile for the route's return journey.
								</label>
							  </div>
					<small>If it's checked off, then we'll assume the return journey's shape is a mirror copy of the onward journey.</small></p>
				</div>
				<div class="col-md-6">	
					<p align="right"><input type="file" id="uploadShape1" name="uploadShape1" class="btn btn-sm btn-outline-secondary" accept=".geojson">
						<br><small>This is for cases where the return journey's path diverges from the onward journey.</small>
					</p>
				</div>
			</div>			
				
		</div>
      </div>
      <div class="modal-footer">
			<p align="center" id="uploadShapeStatus"></p>		
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button id="uploadShapeButton" class="btn btn-primary">Upload >></button>
      </div>
    </div>
  </div>
</div>
	<!-- End The Modal -->
</body>  
</html>
